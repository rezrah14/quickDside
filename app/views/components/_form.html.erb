<%= render "shared/errors", obj: @component %>
<div class="row justify-content-center">
  <div class="col-10">
    <%= form_with(model: @component, url: project_components_path(@project), local: true, class: "shadow p-3 mb-3 bg-light rounded") do |form| %>
      <br>
      <div class="form-group row">
        <%= form.label :name, class: "col-2 col-form-label text-center" %>
        <div class="col-4">
          <%= form.text_field :name, class: "form-control shadow rounded" %>
        </div>
        <%= form.label :quantity_type, class: "col-2 col-form-label text-center" %>
        <div class="col-4">
          <%= form.text_field :quantity_type, class: "form-control shadow rounded" %>
        </div>
      </div>
      <br>
      <div class="form-group row">
        <%= form.label :unit_multiplier, class: "col-2 col-form-label text-center" %>
        <div class="col-4">
          <%= form.text_field :unit_multiplier, class: "form-control shadow rounded" %>
        </div>
        <%= form.label :unit, class: "col-2 col-form-label text-center" %>
        <div class="col-4">
          <%= form.text_field :unit, class: "form-control shadow rounded" %>
        </div>
      </div>
      <br>
      <div class="form-group row">
        <%= form.label :price_interpolation_model, class: "col-2 col-form-label text-center" %>
        <div class="col-4">
          <%= form.text_field :price_interpolation_model, class: "form-control shadow rounded" %>
        </div>
        <%= form.label :currency, class: "col-2 col-form-label text-center" %>
        <div class="col-4">
          <%= form.text_field :currency, class: "form-control shadow rounded" %>
        </div>
      </div>
      <br>
      <div class="form-group row">
        <div id="dynamic-fields" class="row">
          <label class="col-2 col-form-label text-center" id="datelabel">Date</label>
          <label class="col-2 col-form-label text-center" id="currencyLabel">Price (US$)</label>
          <label class="col-1 col-form-label text-center"></label>
        </div>
      </div>
      <div class="text-center">
        <button type="button" onclick="addRow()" class="btn btn-success">Add Date & Price</button>
      </div>
      <br>
      <br>
      <div class="text-center">
        <% if @component.new_record? %>
          <button type="button" onclick="addRow()" class="btn btn-success">Append Price Profile</button>
          <%= form.submit "Create Component", class: "btn btn-primary" %>
        <% else %>
          <%= form.submit "Update Component", class: "btn btn-primary" %>
        <% end %>
        <%= link_to "Cancel", project_components_path(@project), class: "btn btn-secondary" %>
      </div>
      <div class="text-center">
        <script>
          var currencyValue = "US$";

          // To ensure at least one row exists initially
          addRow();

          function addRow() {
            var newRow = document.createElement("div");
            newRow.classList.add("row");

            newRow.innerHTML = `
              <div class="col-2">
                <input type="date" class="form-control shadow rounded">
              </div>
              <div class="col-2">
                <input type="text" class="form-control shadow rounded">
              </div>
              <div class="col-1">
                <button type="button" onclick="deleteRow(this)" class="btn text-danger px-1 py-1" style="border: none;">X</button>
              `;

            document.getElementById("dynamic-fields").appendChild(newRow);
            document.getElementById("datelabel").innerHTML = "Date";
            document.getElementById("currencyLabel").innerHTML = "Price (US$)";
          }

          function deleteRow(button) {
            // Ensure at least one row remains before deletion
            if (document.querySelectorAll("#dynamic-fields .row").length > 1) {
              button.parentElement.parentElement.remove();
            } else {
              // You might want to show a message indicating the requirement of at least one row.
              console.log("At least one row must exist.");
            }
          }
        </script>
      </duv>
    <% end %>
  </div>
</div>
